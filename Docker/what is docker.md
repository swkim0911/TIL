# what is docker

## 도커란 
- 도커는 컨테이너의 생명주기를 쉽게 관리할 수 있는 플랫폼을 제공한다.
- 도커는 컨테이너라고 불리는 느슨하게 격리된 환경에서 애플리케이션을 패키징하고 실행할 수 있는 기술을 쉽게 사용할 수 있도록 만들어진 플랫폼이다.

## 컨테이너란
컨테이너는 애플리케이션 코드와, 이를 실행하는데 필요한 특정 버전의 런타임과 라이브러리 같은 종속 환경을 함께 묶어 일관되고 격리된 환경에서 실행할 수 있도록 만든 패키지이다.

### VM과 컨테이너 차이
우선 가상화(virtualization)는 하드웨어 리소스를 추상적으로 표현하여 사용하는 것을 말한다. 예를 들어, 가상 메모리라고 하면, 메모리라는 하드웨어 리소스를 추상적으로 표현하여 사용한다. 즉, 실제 메모리(물리 메모리)를 추상화하여 새로운 계층인 가상 메모리를 만들어 낸다. 추상 계층이 1단계 늘어났기 때문에 메모리에 접근할 떄는 가상 메모리 -> 물리 메모리의 형태가 되고, 프로그래머는 물리 메모리의 특성에 대해 알 필요가 없게 된다.

Virtual Machine(VM)은 하드웨어 위에 하이퍼바이저를 통해 생성된 완전히 독립된 '가상 컴퓨터'이며, 자체 운영체제(Guest OS)와 커널을 포함하여 실제 컴퓨터처럼 동작하는 실행 환경이다.

> 하이퍼바이저는 CPU. 메모리, 디스크, 네트워크 같은 물리적 자원을 가상화해서 각 VM이 자신만의 하드웨어를 갖고 있는 것처럼 보이도록 만드는 가상화 소프트웨어이다. 반대로 도커는 하드웨어를 흉내내는게 아니라 리눅스 커널 기능을 이용해서 프로세스를 격리한 실행 환경(컨테이너)을 만든다.

도커 컨테이너는 VM처럼 보이지만 호스트 운영체제 커널을 공유하는 가벼운 격리된 실행 환경이다. 자체 커널이나 하드웨어 드라이버는 없지만, 고유한 파일 시스템, 환경 변수, 네트워크 인터페이스 등을 갖고 있어 마치 가벼운 VM처럼 동작하는 것으로 보인다.

정리하면 VM은 하드웨어를 가상화해 만든 '완전한 가상 컴퓨터'이고, 독립적인 Guest OS와 커널, 하드웨어를 갖는다. 반면 도커 컨테이너는 OS 수준 가상화로, 호스트 커널을 공유하며 프로세스를 격리하는 실행 환경이다.

### 도커 컨테이너의 장단점
#### 장점
- 각각의 컨테이너들은 독립된 환경을 갖기 때문에, 컨테이너에 속한 프로그램들의 의존성 충돌이나 환경 설정에 문제 없이 안정적으로 실행할 수 있다.

- 컨테이너는 이미지로 만들 수 있고 이미지는 컨테이너로 만들 수 있기 때문에 개발환경과 배포환경을 일치시키는데 쉽고 팀에서 팀원 모두 동일환 환경을 세팅할 수 있다.

- 컨테이너는 빠르게 생성하고 삭제할 수 있기 때문에 스케일링에 유리해서 웹 서버나 API 서버에 활용된다.
  
#### 단점
- 컨테이너는 모두 동일한 (리눅스) 커널 위에서 실행되므로 하나의 컨테이너로 인해 커널에 문제(커널 패닉 등)를 발생시키면 해당 호스트에서 실행 중인 모든 컨테이너에 영향을 줄 수 있다.

- 컨테이너는 호스트 커널을 사용하므로 다른 운영체제를 에뮬레이션할 수 없다.


## 도커 관련 주요 개념

### 도커 이미지
컨테이너를 생성하기 위한 템플릿(설계도)이다. 

애플리케이션 실행에 필요한 설정, 라이브러리, 파일 시스템 등을 포함한 불변(immutable) 패키지이다. 불변이라고 말하는 이유는 도커 이미지는 여러 개의 `read-only` 레이어(layer)로 이루어져 있기 때문이다.

예를 들어 Dockerfile이

```
FROM ubuntu:22.04
RUN apt-get install -y curl
COPY app.py /app.py
```

이렇게 구성되면 이미지 구조는 아래와 같이 쌓인다.
- Layer 1: ubuntu:22.04
- Layer 2: apt-get install curl 결과 -> curl 패키지 설치
- Layer 3: app.py 파일 추가

이 레이어들은 모드 read-only(읽기 전용)이기 때문에, 이미지를 수정할 수 없다. 단, 기존 이미지를 기반으로 새 레이어를 위에 추가하여 새로운 이미지를 만드는 것은 가능하다.

### 도커파일 (Dockerfile)
이미지를 어떻게 만들지 정의해 놓은 빌드 스크립트이다. FROM, RUN, COPY, EXPOSE 등 지시어를 사용한다.

### 도커 컴포즈 
멀티 컨테이너 애플리케이션을 정의하고 관리하는데 사용된다. YAML 파일을 통해 각 컨테이너의 설정, 네트워크 연결, 볼륨 마운트 등을 선언적으로 정의할 수 있으며, 이러한 설정을 바탕으로 여러 컨테이너를 하나의 서비스처럼 묶어서 실행하고 관리할 수 있다.


#### 도커 볼륨
도커 볼륨은 컨테이너의 데이터를 외부에 영구적으로 저장하기 위한 스토리지이다. 컨테이너가 삭제되거나 재시작되더라도 데이터가 유지되며, 여러 컨테이너가 동일한 데이터를 공유할 수 있다.

#### 도커 네트워크
도커 네트워크는 컨테이너 간 통신을 제어하고, 외부와 컨테이너를 연결해주는 가상 네트워크 계층이다.
Bridge 네트워크가 기본적으로 사용되며, 같은 네트워크에 있는 컨테이너들은 서비스 이름으로 서로 접근할 수 있다.

> Bridge 네트워크는 도커가 기본적으로 제공하는 가상 네트워크이며, 동일한 호스트 내에서 실행되는 여러 컨테이너가 서로 통신할 수 있도록 가상의 스위치 역할을 한다. 외부와는 기본적으로 격리되어 있으며, 포트 매핑을 통해서만 외부에서 컨테이너로 접근할 수 있다.


### 출처
- https://showx123.tistory.com/54
- https://cloud.google.com/learn/what-are-containers
- https://docs.docker.com/get-started/docker-overview/
