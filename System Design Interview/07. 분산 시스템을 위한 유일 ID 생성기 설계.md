# 분산 시스템 환경에서의 유일 ID 생성
분산 시스템이기 때문에 하나의 DB 서버에서 Auto Increment로는 부족하다. 그렇다고 여러 DB 서버를 두면 서버 내 ID는 유일성을 보장하지만 서버 전체 범위에서의 유일성은 보장하지 않는다.

# 1. 설계 범위
- ID는 유일하고 숫자로만 구성된다.
- ID는 64bit로 표현될 수 있는 값이어야 한다. (2^64-1: 20자리)
- ID는 발급 날짜에 따라 정렬 가능해야 한다. (ID는 시간의 흐름에 따라 커진다.)
- 초당 10,000개의 ID를 만들 수 있어야 한다.

# 2. 분산 시스템에서 유일성이 보장되는 ID를 만드는 방법

## 다중 마스터 복제 (mulit-master replication)
다중 마스터 복제 환경에서 여러 데이터베이스 서버가 각각 ID를 생성하고 이를 고정 값 k만큼 증가시켜 유일한 id를 생성한다. k는 서버 수를 나타낸다. 예를 들어, 서버가 3개라면 첫 번째 서버는 0, 3, 6 .. 두 번째 서버는 1, 4, 7 .. 세 번째 서버는 2, 5, 8 .. 로 ID를 생성한다.

하지만 단점으로 서버를 추가/삭제할 경우 k 값이 바뀌기 때문에 잘 동작하기 어렵다.그리고 ID 값이 시간의 흐름에 따라 커짐을 보장할 수 없다.

## UUID
UUID는 컴퓨터 시스템에 저장되는 정보를 유일하게 식별하기 위한 128비트 수이며 충돌 가능성이 지극히 낮다. 
> 위키피디아에 따르면 중복 UUID가 생길 확률로 50%로 끌어 올리려면 초당 10억 개의 UUID를 100년 동안 계속해서 만들어야 한다.

UUID는 서버 간 조율 없이 독립적으로 생성 가능하다. 따라서 각 웹 서버는 별도의 ID 생성기를 사용해 유일한 ID를 만들어 낸다.

하지만 UUID는 시간순으로 정렬할 수 없고 숫자가 아닌 값이 포함될 수 있다.

## 티켓 서버
 이 방식은 auto_increment 기능을 갖춘 데이터베이스 서버, 즉 티켓 서버를 중앙 집중형으로 하나만 사용하는 것이다. 
 
장점
 - 유일성이 보장되는 숫자로만 구성된 ID를 쉽게 만들 수 있다.
 - 구현하기 쉽고, 중소 규모 애플리케이션에 적합하다.

단점
- SPOF(Single Point Of Failure) 문제가 있다. 이 이슈를 피하기 위해 여러 서버를 둔다면 동기화 같은 새로운 문제가 발생한다.

> Flickr 라는 기업에서는 샤딩을 할 때 각 DB 서버의 기본 키가 전역적으로 고유하게 하기 위해 티켓 서버를 사용한다고 한다. - https://code.flickr.net/2010/02/08/ticket-servers-distributed-unique-primary-keys-on-the-cheap/ 
## 트위터 스노플레이크 접근법